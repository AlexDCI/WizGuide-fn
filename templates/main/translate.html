{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/translate.css' %}?v=3">
{% endblock %}

{% block content %}
<div class="app-shell">
  <div class="panel">

    <!-- –§–û–†–ú–ê -->
    <form method="post" class="form">
      {% csrf_token %}

      <label for="text" class="label">{{ translations.text_label }}:</label>
      <textarea id="text" name="text" maxlength="1000"
                class="input input--area"
                placeholder="{{ translations.text_placeholder }}"></textarea>

      <div class="row row--langs">
        <select id="source_lang" name="source_lang" class="input" aria-label="{{ translations.source_lang_label }}">
          <option value="" disabled {% if not source_lang %}selected{% endif %}>
            {{ translations.select_language_placeholder }}
          </option>
          {% for lang in languages %}
            <option value="{{ lang }}" {% if source_lang == lang %}selected{% endif %}>{{ lang }}</option>
          {% endfor %}
        </select>

        <button type="button" id="swap-languages" class="swap"
                title="{{ translations.swap_title }}">‚Üî</button>

        <select id="target_lang" name="target_lang" class="input" aria-label="{{ translations.target_lang_label }}">
          <option value="" disabled {% if not target_lang %}selected{% endif %}>
            {{ translations.select_language_placeholder }}
          </option>
          {% for lang in languages %}
            <option value="{{ lang }}" {% if target_lang == lang %}selected{% endif %}>{{ lang }}</option>
          {% endfor %}
        </select>
      </div>

      <label for="comment_request" class="label">{{ translations.comment_request_label }}:</label>
      <textarea id="comment_request" name="comment_request" maxlength="1000"
                class="input input--area input--comment"
                placeholder="{{ translations.optional }}"></textarea>

      <button type="submit" class="btn btn--primary w-100">{{ translations.translate_btn }}</button>
    </form>

    <!-- VOICE -->
    <section class="voice">
      <div class="voice__header"><h2>{{ translations.voice_title }}</h2></div>

      <div class="mic">
        <canvas id="micWaves" width="120" height="120"></canvas>
        <button id="micBtn" class="mic__btn"
                title="{{ translations.mic_hint }}">üé§</button>
        <div id="v_status" class="mic__status">{{ translations.mic_ready }}</div>
      </div>

      <div class="voice__out" id="v_src"><b>üìù {{ translations.voice_recognized_label }}</b>\n‚Äî</div>
      <div class="voice__out" id="v_trg"><b>üåç {{ translations.voice_translation_label }}</b>\n‚Äî</div>
    </section>

    <!-- –ò–°–¢–û–†–ò–Ø -->
    <section class="history chat-history">
      <div class="history__bar">
        <h3 class="m-0">{{ translations.history_label }}</h3>
        <form method="post" action="{% url 'clear_chat' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn--ghost btn--danger">
            {{ translations.clear_chat_btn }}
          </button>
        </form>
      </div>

      {% if chat_history %}
        <ul class="list-group history__list">
          {% for chat in chat_history %}
            <li class="list-group-item history__item">
              <strong>{{ chat.input_text }}</strong> <span class="arr">‚Üí</span> <em>{{ chat.translated_text }}</em>
              {% if chat.comment %}
                <div class="history__comment">
                  <small>{{ translations.explanation_label }}: {{ chat.comment }}</small>
                </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="history__empty">{{ translations.empty_history_label }}</div>
      {% endif %}
    </section>

  </div>
</div>

<script src="{% static 'js/translate.js' %}"></script>
<script src="{% static 'js/voice.js' %}?v=6"></script>
{% endblock %}
