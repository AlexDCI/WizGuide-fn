{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/translate.css' %}">
<style>
  #meter{width:100%;height:12px;background:#eee;border-radius:6px;overflow:hidden}
  #level{height:100%;width:0%;background:lime}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid d-flex justify-content-center p-0">
  <div class="form-container">
    <h1>{{ translations.title }}</h1>
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <!-- —Ñ–æ—Ä–º–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ -->
    <form method="post">
      {% csrf_token %}
      <label for="text">{{ translations.text_label }}:</label>
      <textarea name="text" id="text" class="form-control mb-3 text-area-large" maxlength="1000"></textarea>

      <div class="d-flex align-items-center mb-3">
        <select name="source_lang" id="source_lang" class="form-select">
          <option value="" disabled {% if not source_lang %}selected{% endif %}>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫</option>
          {% for lang in languages %}
            <option value="{{ lang }}" {% if source_lang == lang %}selected{% endif %}>{{ lang }}</option>
          {% endfor %}
        </select>

        <button type="button" id="swap-languages" class="btn btn-secondary mx-2">‚Üî</button>

        <select name="target_lang" id="target_lang" class="form-select">
          <option value="" disabled {% if not target_lang %}selected{% endif %}>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫</option>
          {% for lang in languages %}
            <option value="{{ lang }}" {% if target_lang == lang %}selected{% endif %}>{{ lang }}</option>
          {% endfor %}
        </select>
      </div>

      <label for="comment_request">{{ translations.comment_request_label }}:</label>
      <textarea name="comment_request" id="comment_request" class="form-control mb-3 comment-area-large"
        placeholder="{{ translations.optional }}" maxlength="1000"></textarea>

      <button type="submit" class="btn btn-primary w-100">{{ translations.translate_btn }}</button>
    </form>

    <form method="post" action="{% url 'clear_chat' %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger w-100 mt-3 custom-clear-btn">Clear Chat</button>
    </form>

    {% if chat_history %}
    <div class="chat-history mt-4 p-3 bg-light rounded">
      <h3>{{ translations.history_label }}</h3>
      <ul class="list-group">
        {% for chat in chat_history %}
          <li class="list-group-item">
            <strong>{{ chat.input_text }}</strong> ‚Üí <em>{{ chat.translated_text }}</em>
            {% if chat.comment %}
              <br><small>{{ translations.explanation_label }}: {{ chat.comment }}</small>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
</div>

<!-- üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π –ø–µ—Ä–µ–≤–æ–¥ -->
<div class="mt-5 p-3 bg-light rounded">
  <h3>üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π –ø–µ—Ä–µ–≤–æ–¥</h3>

  <div class="d-flex gap-2 align-items-center mb-2">
    <label>–° —è–∑—ã–∫–∞:</label>
    <select id="voice_source" class="form-select" style="max-width:200px">
      <option value="auto">–ê–≤—Ç–æ</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="en">English</option>
      <option value="de">Deutsch</option>
    </select>

    <label>–ù–∞ —è–∑—ã–∫:</label>
    <select id="voice_target" class="form-select" style="max-width:200px">
      <option value="en">English</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="de">Deutsch</option>
    </select>
  </div>

  <div class="row mb-2">
    <button id="recBtn" class="btn btn-primary">‚óè –ó–∞–ø–∏—Å–∞—Ç—å</button>
    <button id="stopBtn" class="btn btn-secondary" disabled>‚ñ† –°—Ç–æ–ø</button>
  </div>

  <p id="status">–ì–æ—Ç–æ–≤–æ</p>
  <div id="meter"><div id="level"></div></div>

  <div class="box mt-3 p-2 bg-white border rounded" id="recognized">üìù –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n‚Äî</div>
  <div class="box mt-2 p-2 bg-white border rounded" id="translated">üåç –ü–µ—Ä–µ–≤–æ–¥:\n‚Äî</div>
</div>

<!-- –æ–±—â–∏–π JS -->
<script src="{% static 'js/translate.js' %}"></script>
<!-- –≥–æ–ª–æ—Å–æ–≤–æ–π JS -->
<script src="{% static 'js/voice.js' %}"></script>
{% endblock %}
